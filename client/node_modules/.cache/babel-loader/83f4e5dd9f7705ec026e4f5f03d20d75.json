{"ast":null,"code":"import React,{useReducer,useCallback,useEffect}from\"react\";import Web3 from\"web3\";import EthContext from\"./EthContext\";import{reducer,actions,initialState}from\"./state\";import{jsx as _jsx}from\"react/jsx-runtime\";function EthProvider(_ref){let{children}=_ref;const[state,dispatch]=useReducer(reducer,initialState);const init=useCallback(async artifact=>{if(artifact){const web3=new Web3(Web3.givenProvider||\"ws://localhost:8545\");const accounts=await web3.eth.requestAccounts();const networkID=await web3.eth.net.getId();const{abi}=artifact;let address,contract;try{address=artifact.networks[networkID].address;contract=new web3.eth.Contract(abi,address);}catch(err){console.error(err);}dispatch({type:actions.init,data:{artifact,web3,accounts,networkID,contract}});}},[]);useEffect(()=>{const tryInit=async()=>{try{const artifact=require(\"../../contracts/ElectionPortal.json\");init(artifact);}catch(err){console.error(err);}};tryInit();},[init]);useEffect(()=>{const events=[\"chainChanged\",\"accountsChanged\"];const handleChange=()=>{init(state.artifact);};events.forEach(e=>window.ethereum.on(e,handleChange));return()=>{events.forEach(e=>window.ethereum.removeListener(e,handleChange));};},[init,state.artifact]);return/*#__PURE__*/_jsx(EthContext.Provider,{value:{state,dispatch},children:children});}export default EthProvider;","map":{"version":3,"names":["React","useReducer","useCallback","useEffect","Web3","EthContext","reducer","actions","initialState","jsx","_jsx","EthProvider","_ref","children","state","dispatch","init","artifact","web3","givenProvider","accounts","eth","requestAccounts","networkID","net","getId","abi","address","contract","networks","Contract","err","console","error","type","data","tryInit","require","events","handleChange","forEach","e","window","ethereum","on","removeListener","Provider","value"],"sources":["C:/Users/HongYaeJIn/Desktop/yaejin/과제/2023/web2/blockvote-polygon-hackathon/client/src/contexts/EthContext/EthProvider.jsx"],"sourcesContent":["import React, { useReducer, useCallback, useEffect } from \"react\";\r\nimport Web3 from \"web3\";\r\nimport EthContext from \"./EthContext\";\r\nimport { reducer, actions, initialState } from \"./state\";\r\n\r\nfunction EthProvider({ children }) {\r\n\tconst [state, dispatch] = useReducer(reducer, initialState);\r\n\r\n\tconst init = useCallback(async (artifact) => {\r\n\t\tif (artifact) {\r\n\t\t\tconst web3 = new Web3(Web3.givenProvider || \"ws://localhost:8545\");\r\n\t\t\tconst accounts = await web3.eth.requestAccounts();\r\n\t\t\tconst networkID = await web3.eth.net.getId();\r\n\t\t\tconst { abi } = artifact;\r\n\t\t\tlet address, contract;\r\n\t\t\ttry {\r\n\t\t\t\taddress = artifact.networks[networkID].address;\r\n\t\t\t\tcontract = new web3.eth.Contract(abi, address);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t\tdispatch({\r\n\t\t\t\ttype: actions.init,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tartifact,\r\n\t\t\t\t\tweb3,\r\n\t\t\t\t\taccounts,\r\n\t\t\t\t\tnetworkID,\r\n\t\t\t\t\tcontract,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst tryInit = async () => {\r\n\t\t\ttry {\r\n\t\t\t\tconst artifact = require(\"../../contracts/ElectionPortal.json\");\r\n\t\t\t\tinit(artifact);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\ttryInit();\r\n\t}, [init]);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst events = [\"chainChanged\", \"accountsChanged\"];\r\n\t\tconst handleChange = () => {\r\n\t\t\tinit(state.artifact);\r\n\t\t};\r\n\r\n\t\tevents.forEach((e) => window.ethereum.on(e, handleChange));\r\n\t\treturn () => {\r\n\t\t\tevents.forEach((e) =>\r\n\t\t\t\twindow.ethereum.removeListener(e, handleChange),\r\n\t\t\t);\r\n\t\t};\r\n\t}, [init, state.artifact]);\r\n\r\n\treturn (\r\n\t\t<EthContext.Provider\r\n\t\t\tvalue={{\r\n\t\t\t\tstate,\r\n\t\t\t\tdispatch,\r\n\t\t\t}}>\r\n\t\t\t{children}\r\n\t\t</EthContext.Provider>\r\n\t);\r\n}\r\n\r\nexport default EthProvider;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,UAAU,CAAEC,WAAW,CAAEC,SAAS,KAAQ,OAAO,CACjE,MAAO,CAAAC,IAAI,KAAM,MAAM,CACvB,MAAO,CAAAC,UAAU,KAAM,cAAc,CACrC,OAASC,OAAO,CAAEC,OAAO,CAAEC,YAAY,KAAQ,SAAS,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAEzD,QAAS,CAAAC,WAAWA,CAAAC,IAAA,CAAe,IAAd,CAAEC,QAAS,CAAC,CAAAD,IAAA,CAChC,KAAM,CAACE,KAAK,CAAEC,QAAQ,CAAC,CAAGd,UAAU,CAACK,OAAO,CAAEE,YAAY,CAAC,CAE3D,KAAM,CAAAQ,IAAI,CAAGd,WAAW,CAAC,KAAO,CAAAe,QAAQ,EAAK,CAC5C,GAAIA,QAAQ,CAAE,CACb,KAAM,CAAAC,IAAI,CAAG,GAAI,CAAAd,IAAI,CAACA,IAAI,CAACe,aAAa,EAAI,qBAAqB,CAAC,CAClE,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAF,IAAI,CAACG,GAAG,CAACC,eAAe,CAAC,CAAC,CACjD,KAAM,CAAAC,SAAS,CAAG,KAAM,CAAAL,IAAI,CAACG,GAAG,CAACG,GAAG,CAACC,KAAK,CAAC,CAAC,CAC5C,KAAM,CAAEC,GAAI,CAAC,CAAGT,QAAQ,CACxB,GAAI,CAAAU,OAAO,CAAEC,QAAQ,CACrB,GAAI,CACHD,OAAO,CAAGV,QAAQ,CAACY,QAAQ,CAACN,SAAS,CAAC,CAACI,OAAO,CAC9CC,QAAQ,CAAG,GAAI,CAAAV,IAAI,CAACG,GAAG,CAACS,QAAQ,CAACJ,GAAG,CAAEC,OAAO,CAAC,CAC/C,CAAE,MAAOI,GAAG,CAAE,CACbC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC,CACnB,CACAhB,QAAQ,CAAC,CACRmB,IAAI,CAAE3B,OAAO,CAACS,IAAI,CAClBmB,IAAI,CAAE,CACLlB,QAAQ,CACRC,IAAI,CACJE,QAAQ,CACRG,SAAS,CACTK,QACD,CACD,CAAC,CAAC,CACH,CACD,CAAC,CAAE,EAAE,CAAC,CAENzB,SAAS,CAAC,IAAM,CACf,KAAM,CAAAiC,OAAO,CAAG,KAAAA,CAAA,GAAY,CAC3B,GAAI,CACH,KAAM,CAAAnB,QAAQ,CAAGoB,OAAO,CAAC,qCAAqC,CAAC,CAC/DrB,IAAI,CAACC,QAAQ,CAAC,CACf,CAAE,MAAOc,GAAG,CAAE,CACbC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC,CACnB,CACD,CAAC,CAEDK,OAAO,CAAC,CAAC,CACV,CAAC,CAAE,CAACpB,IAAI,CAAC,CAAC,CAEVb,SAAS,CAAC,IAAM,CACf,KAAM,CAAAmC,MAAM,CAAG,CAAC,cAAc,CAAE,iBAAiB,CAAC,CAClD,KAAM,CAAAC,YAAY,CAAGA,CAAA,GAAM,CAC1BvB,IAAI,CAACF,KAAK,CAACG,QAAQ,CAAC,CACrB,CAAC,CAEDqB,MAAM,CAACE,OAAO,CAAEC,CAAC,EAAKC,MAAM,CAACC,QAAQ,CAACC,EAAE,CAACH,CAAC,CAAEF,YAAY,CAAC,CAAC,CAC1D,MAAO,IAAM,CACZD,MAAM,CAACE,OAAO,CAAEC,CAAC,EAChBC,MAAM,CAACC,QAAQ,CAACE,cAAc,CAACJ,CAAC,CAAEF,YAAY,CAC/C,CAAC,CACF,CAAC,CACF,CAAC,CAAE,CAACvB,IAAI,CAAEF,KAAK,CAACG,QAAQ,CAAC,CAAC,CAE1B,mBACCP,IAAA,CAACL,UAAU,CAACyC,QAAQ,EACnBC,KAAK,CAAE,CACNjC,KAAK,CACLC,QACD,CAAE,CAAAF,QAAA,CACDA,QAAQ,CACW,CAAC,CAExB,CAEA,cAAe,CAAAF,WAAW"},"metadata":{},"sourceType":"module"}